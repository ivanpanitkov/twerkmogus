<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–ì –ö–ª–∏–∫–µ—Ä</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            text-align: center;
            max-width: 400px;
            width: 100%;
        }
        
        .counter {
            font-size: 64px;
            font-weight: bold;
            margin: 20px 0;
            color: var(--tg-theme-button-color, #2481cc);
        }
        
        .click-circle {
            width: 200px;
            height: 200px;
            background: var(--tg-theme-button-color, #2481cc);
            border-radius: 50%;
            margin: 30px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
            transition: transform 0.1s;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .click-circle:active {
            transform: scale(0.95);
        }
        
        .button {
            background: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            width: 100%;
            transition: opacity 0.3s;
        }
        
        .button:hover {
            opacity: 0.9;
        }
        
        .button.secondary {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            color: var(--tg-theme-text-color, #000000);
        }
        
        .user-info {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: left;
        }
        
        h1 {
            margin-bottom: 20px;
            color: var(--tg-theme-text-color, #000000);
        }
        
        .buttons-row {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Telegram –ö–ª–∏–∫–µ—Ä</h1>
        
        <div class="user-info" id="userInfo">
            –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
        </div>
        
        <div class="counter" id="counter">0</div>
        
        <div class="click-circle" id="clickCircle">
            –ö–õ–ò–ö!
        </div>
        
        <div class="buttons-row">
            <button class="button secondary" id="resetBtn">–°–±—Ä–æ—Å–∏—Ç—å</button>
            <button class="button" id="multiplyBtn">√ó2</button>
        </div>
        
        <button class="button" id="saveBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="button secondary" id="closeBtn">‚úñ –ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        
        // –†–∞—Å—à–∏—Ä—è–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
        tg.expand();
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const user = tg.initDataUnsafe?.user;
        let clickCount = 0;
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const counterEl = document.getElementById('counter');
        const clickCircle = document.getElementById('clickCircle');
        const resetBtn = document.getElementById('resetBtn');
        const multiplyBtn = document.getElementById('multiplyBtn');
        const saveBtn = document.getElementById('saveBtn');
        const closeBtn = document.getElementById('closeBtn');
        const userInfoEl = document.getElementById('userInfo');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        if (user) {
            userInfoEl.innerHTML = `
                üë§ <b>${user.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}</b>
                ${user.last_name ? user.last_name : ''}
                ${user.username ? `<br>@${user.username}` : ''}
            `;
        } else {
            userInfoEl.innerHTML = 'üë§ –ì–æ—Å—Ç—å';
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
        function updateCounter() {
            counterEl.textContent = clickCount;
            
            // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –∫—Ä—É–≥–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—á–µ—Ç–∞
            const circle = document.getElementById('clickCircle');
            const hue = (clickCount * 10) % 360;
            circle.style.background = `hsl(${hue}, 70%, 60%)`;
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫—Ä—É–≥—É
        clickCircle.addEventListener('click', () => {
            clickCount++;
            updateCounter();
            
            // –ê–Ω–∏–º–∞—Ü–∏—è
            clickCircle.style.transform = 'scale(0.95)';
            setTimeout(() => {
                clickCircle.style.transform = 'scale(1)';
            }, 100);
        });
        
        // –°–±—Ä–æ—Å
        resetBtn.addEventListener('click', () => {
            clickCount = 0;
            updateCounter();
        });
        
        // –£–º–Ω–æ–∂–µ–Ω–∏–µ
        multiplyBtn.addEventListener('click', () => {
            if (clickCount > 0) {
                clickCount *= 2;
                updateCounter();
            }
        });
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        saveBtn.addEventListener('click', () => {
            const data = {
                action: 'save_score',
                score: clickCount,
                user_id: user?.id
            };
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É
            tg.sendData(JSON.stringify(data));
            
            tg.showPopup({
                title: '–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!',
                message: `–í–∞—à —Å—á–µ—Ç: ${clickCount}`,
                buttons: [{ type: 'ok' }]
            });
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ
        closeBtn.addEventListener('click', () => {
            tg.close();
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateCounter();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º Main Button –≤–Ω–∏–∑—É
        tg.MainButton.setText(`–°—á–µ—Ç: ${clickCount}`);
        tg.MainButton.onClick(() => {
            const data = {
                action: 'save_via_button',
                score: clickCount
            };
            tg.sendData(JSON.stringify(data));
            tg.close();
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—á–µ—Ç–∞
        setInterval(() => {
            tg.MainButton.setText(`–°—á–µ—Ç: ${clickCount}`);
        }, 1000);
    </script>
</body>
</html>
